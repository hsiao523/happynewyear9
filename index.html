<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta property="og:title" content="é»æˆ‘åˆ®å¤§çï¼è²¡ç¥åˆ°åˆ®åˆ®æ¨‚">
    <meta property="og:description" content="é¦¬ä¸Šä¾†åˆ®åˆ®,è²¡ç¥åˆ°ä½ å®¶ï¼">
    <meta property="og:image" content="https://hsiao523.github.io/happynewyear9/title.jpg">
    <title>è²¡ç¥åˆ°åˆ®åˆ®æ¨‚</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: url('https://hsiao523.github.io/happynewyear9/background.jpg') no-repeat center center;
            background-size: cover;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
            font-family: "Microsoft JhengHei", sans-serif;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 90px);
            grid-template-rows: repeat(3, 80px);
            gap: 6px;
            padding: 15px;
            margin-top: 52vh;
            background: rgba(0, 0, 0, 0.1); 
            border-radius: 15px;
            position: relative;
        }

        .scratch-card {
            position: relative;
            width: 90px;
            height: 80px;
            background: #fff3e0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        /* åº•éƒ¨ç•«å¸ƒï¼šè² è²¬ç²’å­ç‰¹æ•ˆ */
        .particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* ä¸å¹²æ“¾è§¸æ§ */
            z-index: 3;
        }

        /* é ‚éƒ¨ç•«å¸ƒï¼šè² è²¬åˆ®é™¤é®ç½© */
        .scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            touch-action: none;
            border-radius: 10px;
            transition: opacity 0.4s ease;
            z-index: 2;
        }

        #result-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            z-index: 100;
            text-align: center;
            width: 80%;
            max-width: 300px;
            border: 4px solid #b71c1c;
        }

        #result-modal h2 { color: #b71c1c; margin-top: 0; }
        #result-modal p { font-size: 1.2rem; font-weight: bold; line-height: 1.6; }
        .modal-btn { background: #b71c1c; color: white; border: none; padding: 10px 20px; border-radius: 10px; margin-top: 15px; font-size: 1rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="grid-container" id="grid"></div>

    <div id="result-modal">
        <h2 id="modal-title">æ­å–œï¼</h2>
        <p id="modal-text"></p>
        <button class="modal-btn" onclick="closeModal()">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        const symbolsMap = {
            'ğŸ’°': "åˆ®ä¸­ğŸ’°ï¼Œä»Šå¹´è³ºå¤§éŒ¢ï¼",
            'ğŸ§§': "åˆ®ä¸­ğŸ§§ï¼Œä»Šå¹´ç´…åˆ©é ˜ä¸å®Œï¼",
            'ğŸ’': "åˆ®ä¸­ğŸ’ï¼Œé‡‘éŠ€ç å¯¶æ»¿åé–“ï¼",
            'ğŸŠ': "åˆ®ä¸­ğŸŠï¼Œå¤§å‰å¤§åˆ©ç™¼å¤§è²¡ï¼",
            'âœ¨': "åˆ®ä¸­âœ¨ï¼Œä»Šå¹´é‹å‹¢äº®æ™¶æ™¶ï¼Œå¥½é‹ä¸€ç›´ä¾†ï¼",
            'ğŸ': "åˆ®ä¸­ğŸï¼Œä»Šå¹´æœƒå¹´é ­æ—ºåˆ°å¹´å°¾ï¼",
            'ğŸ§¨': "åˆ®ä¸­ğŸ§¨ï¼Œå¤©å¤©ä¸­å¤§çï¼Œé•ç‚®éŸ¿ä¸åœï¼"
        };

        const gridElement = document.getElementById('grid');
        const modal = document.getElementById('result-modal');
        const modalText = document.getElementById('modal-text');
        
        let clearedCount = 0;
        let winningSymbol = '';
        const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

        // ç²’å­é¡åˆ¥
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 3 + 1;
                this.speedX = Math.random() * 2 - 1;
                this.speedY = Math.random() * 2 - 1;
                this.color = `rgba(255, ${215 + Math.random() * 40}, 0, ${Math.random() * 0.8 + 0.2})`; // é‡‘è‰²
                this.life = 1; // ç”Ÿå‘½é€±æœŸ
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= 0.02;
            }
            draw(ctx) {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initGame() {
            gridElement.innerHTML = '';
            clearedCount = 0;
            modal.style.display = 'none';

            const keys = Object.keys(symbolsMap);
            winningSymbol = keys[Math.floor(Math.random() * keys.length)];
            const winLine = lines[Math.floor(Math.random() * lines.length)];
            
            let board = new Array(9).fill(null);
            winLine.forEach(idx => board[idx] = winningSymbol);

            for (let i = 0; i < 9; i++) {
                if (board[i] === null) {
                    let randomSym;
                    do { randomSym = keys[Math.floor(Math.random() * keys.length)]; } while (randomSym === winningSymbol);
                    board[i] = randomSym;
                }
            }
            board.forEach(sym => createScratchCard(sym));
        }

        function createScratchCard(symbol) {
            const card = document.createElement('div');
            card.className = 'scratch-card';
            card.innerHTML = `<span>${symbol}</span>`;

            // ç‰¹æ•ˆç•«å¸ƒ
            const pCanvas = document.createElement('canvas');
            pCanvas.className = 'particle-canvas';
            const pCtx = pCanvas.getContext('2d');
            
            // åˆ®é™¤ç•«å¸ƒ
            const sCanvas = document.createElement('canvas');
            sCanvas.className = 'scratch-canvas';
            const sCtx = sCanvas.getContext('2d');

            card.appendChild(pCanvas);
            card.appendChild(sCanvas);
            gridElement.appendChild(card);

            pCanvas.width = sCanvas.width = 90;
            pCanvas.height = sCanvas.height = 80;

            // ç¹ªè£½é®ç½©
            const gradient = sCtx.createLinearGradient(0, 0, 90, 80);
            gradient.addColorStop(0, '#C0C0C0');
            gradient.addColorStop(1, '#A9A9A9');
            sCtx.fillStyle = gradient;
            sCtx.fillRect(0, 0, 90, 80);

            let particles = [];
            let isDrawing = false;
            let isRemoved = false;

            // å‹•æ…‹å¾ªç’°æ¸²æŸ“ç²’å­
            function animate() {
                pCtx.clearRect(0, 0, 90, 80);
                for (let i = 0; i < particles.length; i++) {
                    particles[i].update();
                    particles[i].draw(pCtx);
                    if (particles[i].life <= 0) {
                        particles.splice(i, 1);
                        i--;
                    }
                }
                if (!isRemoved || particles.length > 0) {
                    requestAnimationFrame(animate);
                }
            }
            animate();

            function scratch(e) {
                if (!isDrawing || isRemoved) return;
                const rect = sCanvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

                // ç”¢ç”Ÿé‡‘ç²‰ç²’å­
                for (let i = 0; i < 5; i++) {
                    particles.push(new Particle(x, y));
                }

                sCtx.globalCompositeOperation = 'destination-out';
                sCtx.beginPath();
                sCtx.arc(x, y, 18, 0, Math.PI * 2);
                sCtx.fill();
                checkScratchPercent(sCanvas, sCtx);
            }

            function checkScratchPercent(canvas, ctx) {
                if (isRemoved) return;
                const imageData = ctx.getImageData(0, 0, 90, 80);
                const pixels = imageData.data;
                let transparentPixels = 0;
                for (let i = 0; i < pixels.length; i += 4) {
                    if (pixels[i + 3] < 150) transparentPixels++;
                }
                if ((transparentPixels / (90 * 80)) > 0.55) {
                    isRemoved = true;
                    canvas.style.opacity = '0';
                    clearedCount++;
                    setTimeout(() => canvas.remove(), 400);
                    if (clearedCount === 9) showResult();
                }
            }

            sCanvas.addEventListener('mousedown', () => isDrawing = true);
            sCanvas.addEventListener('touchstart', (e) => { isDrawing = true; e.preventDefault(); });
            window.addEventListener('mouseup', () => isDrawing = false);
            window.addEventListener('touchend', () => isDrawing = false);
            sCanvas.addEventListener('mousemove', scratch);
            sCanvas.addEventListener('touchmove', (e) => { scratch(e); e.preventDefault(); });
        }

        function showResult() {
            modalText.innerText = symbolsMap[winningSymbol];
            setTimeout(() => { modal.style.display = 'block'; }, 500);
        }

        function closeModal() { initGame(); }
        initGame();
    </script>
</body>
</html>
