<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta property="og:title" content="é»æˆ‘åˆ®å¤§çï¼è²¡ç¥åˆ°åˆ®åˆ®æ¨‚">
    <meta property="og:description" content="é¦¬ä¸Šä¾†åˆ®åˆ®,è²¡ç¥åˆ°ä½ å®¶ï¼">
    <meta property="og:image" content="https://hsiao523.github.io/happynewyear9/title.jpg">

    <title>è²¡ç¥åˆ°åˆ®åˆ®æ¨‚</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: url('https://hsiao523.github.io/happynewyear9/background.jpg') no-repeat center center;
            background-size: cover;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
            font-family: "Microsoft JhengHei", sans-serif;
        }

        /* ä¹å®®æ ¼å®¹å™¨ - è«‹æ ¹æ“šéœ€è¦ä¿®æ”¹ margin-top */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 90px);
            grid-template-rows: repeat(3, 80px);
            gap: 6px;
            padding: 15px;
            margin-top: 52vh; /* æ‚¨å¯ä»¥è‡ªå·±å¾®èª¿æ­¤æ•¸å€¼ */
            background: rgba(0, 0, 0, 0.1); 
            border-radius: 15px;
            position: relative;
        }

        .scratch-card {
            position: relative;
            width: 90px;
            height: 80px;
            background: #fff3e0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            touch-action: none;
            border-radius: 10px;
            transition: opacity 0.4s ease;
            z-index: 2;
        }

        /* è³€è©å½ˆçª—æ¨£å¼ */
        #result-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            z-index: 100;
            text-align: center;
            width: 80%;
            max-width: 300px;
            border: 4px solid #b71c1c;
        }

        #result-modal h2 {
            color: #b71c1c;
            margin-top: 0;
        }

        #result-modal p {
            font-size: 1.2rem;
            font-weight: bold;
            line-height: 1.6;
        }

        .modal-btn {
            background: #b71c1c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 1rem;
        }
    </style>
</head>
<body>

    <div class="grid-container" id="grid"></div>

    <div id="result-modal">
        <h2 id="modal-title">æ­å–œï¼</h2>
        <p id="modal-text"></p>
        <button class="modal-btn" onclick="closeModal()">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        const symbolsMap = {
            'ğŸ’°': "åˆ®ä¸­ğŸ’°ï¼Œä»Šå¹´è³ºå¤§éŒ¢ï¼",
            'ğŸ§§': "åˆ®ä¸­ğŸ§§ï¼Œä»Šå¹´ç´…åˆ©é ˜ä¸å®Œï¼",
            'ğŸ’': "åˆ®ä¸­ğŸ’ï¼Œé‡‘éŠ€ç å¯¶æ»¿åé–“ï¼",
            'ğŸŠ': "åˆ®ä¸­ğŸŠï¼Œå¤§å‰å¤§åˆ©ç™¼å¤§è²¡ï¼",
            'âœ¨': "åˆ®ä¸­âœ¨ï¼Œä»Šå¹´é‹å‹¢äº®æ™¶æ™¶ï¼Œå¥½é‹ä¸€ç›´ä¾†ï¼",
            'ğŸ': "åˆ®ä¸­ğŸï¼Œä»Šå¹´æœƒå¹´é ­æ—ºåˆ°å¹´å°¾ï¼",
            'ğŸ§¨': "åˆ®ä¸­ğŸ§¨ï¼Œå¤©å¤©ä¸­å¤§çï¼Œé•ç‚®éŸ¿ä¸åœï¼"
        };

        const gridElement = document.getElementById('grid');
        const modal = document.getElementById('result-modal');
        const modalText = document.getElementById('modal-text');
        
        let clearedCount = 0;
        let winningSymbol = '';

        // æ‰€æœ‰é€£ç·šçš„å¯èƒ½æ€§ç´¢å¼• (ä¹å®®æ ¼ 0-8)
        const lines = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // æ©«
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // ç›´
            [0, 4, 8], [2, 4, 6]             // æ–œ
        ];

        function initGame() {
            gridElement.innerHTML = '';
            clearedCount = 0;
            modal.style.display = 'none';

            // 1. éš¨æ©Ÿé¸ä¸€å€‹ç¬¦è™Ÿç•¶é€£ç·šç¬¦è™Ÿ
            const keys = Object.keys(symbolsMap);
            winningSymbol = keys[Math.floor(Math.random() * keys.length)];

            // 2. éš¨æ©Ÿé¸ä¸€æ¢ç·šé€£èµ·ä¾†
            const winLine = lines[Math.floor(Math.random() * lines.length)];
            
            // 3. æº–å‚™ä¹å€‹æ ¼å­çš„å…§å®¹
            let board = new Array(9).fill(null);
            winLine.forEach(idx => board[idx] = winningSymbol);

            // 4. å…¶ä»–æ ¼å­éš¨æ©Ÿå¡«å…¥ (ä¸”é¿å…ç”¢ç”Ÿç¬¬äºŒæ¢ç·šï¼Œé€™è£¡ç°¡å–®è™•ç†å¡«å…¥ä¸åŒç¬¦è™Ÿ)
            for (let i = 0; i < 9; i++) {
                if (board[i] === null) {
                    let randomSym;
                    do {
                        randomSym = keys[Math.floor(Math.random() * keys.length)];
                    } while (randomSym === winningSymbol); // é¿å…å¹²æ“¾è¦–è¦ºï¼Œéç·šæ ¼å­ä¸ç”¨é€£ç·šç¬¦è™Ÿ
                    board[i] = randomSym;
                }
            }

            // 5. ç”Ÿæˆæ ¼å­
            board.forEach(sym => createScratchCard(sym));
        }

        function createScratchCard(symbol) {
            const card = document.createElement('div');
            card.className = 'scratch-card';
            card.innerHTML = `<span>${symbol}</span>`;

            const canvas = document.createElement('canvas');
            card.appendChild(canvas);
            gridElement.appendChild(card);

            const ctx = canvas.getContext('2d');
            canvas.width = 90;
            canvas.height = 80;

            const gradient = ctx.createLinearGradient(0, 0, 90, 90);
            gradient.addColorStop(0, '#C0C0C0');
            gradient.addColorStop(1, '#A9A9A9');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 90, 90);

            let isDrawing = false;
            let isRemoved = false;

            function scratch(e) {
                if (!isDrawing || isRemoved) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 18, 0, Math.PI * 2);
                ctx.fill();
                checkScratchPercent(canvas, ctx);
            }

            function checkScratchPercent(canvas, ctx) {
                if (isRemoved) return;
                const imageData = ctx.getImageData(0, 0, 90, 90);
                const pixels = imageData.data;
                let transparentPixels = 0;
                for (let i = 0; i < pixels.length; i += 4) {
                    if (pixels[i + 3] < 150) transparentPixels++;
                }
                
                if ((transparentPixels / (90 * 90)) > 0.55) {
                    isRemoved = true;
                    canvas.style.opacity = '0';
                    clearedCount++;
                    setTimeout(() => canvas.remove(), 400);

                    if (clearedCount === 9) {
                        showResult();
                    }
                }
            }

            canvas.addEventListener('mousedown', () => isDrawing = true);
            canvas.addEventListener('touchstart', (e) => { isDrawing = true; e.preventDefault(); });
            window.addEventListener('mouseup', () => isDrawing = false);
            window.addEventListener('touchend', () => isDrawing = false);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('touchmove', (e) => { scratch(e); e.preventDefault(); });
        }

        function showResult() {
            modalText.innerText = symbolsMap[winningSymbol];
            setTimeout(() => {
                modal.style.display = 'block';
            }, 500);
        }

        function closeModal() {
            initGame();
        }

        initGame();
    </script>
</body>
</html>
