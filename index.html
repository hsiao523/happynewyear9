<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta property="og:title" content="ÈªûÊàëÂàÆÂ§ßÁçéÔºÅË≤°Á•ûÈªûÂêçÂàÆÂàÆÊ®Ç">
    <meta property="og:description" content="ÁúãÁúãÂì™ÂÄãÈñãÈÅãÂ∞èÁâ©Âá∫ÁèæÊúÄÂ§öÊ¨°Ôºü">
    <meta property="og:image" content="https://hsiao523.github.io/happynewyear9/title.jpg">
    <title>Ë≤°Á•ûÈªûÂêçÂàÆÂàÆÊ®Ç</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: url('https://hsiao523.github.io/happynewyear9/background.jpg') no-repeat center center;
            background-size: cover;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
            font-family: "Microsoft JhengHei", sans-serif;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 90px);
            grid-template-rows: repeat(3, 80px);
            gap: 6px;
            padding: 15px;
            margin-top: 52vh;
            background: rgba(0, 0, 0, 0.1); 
            border-radius: 15px;
            position: relative;
        }

        .scratch-card {
            position: relative;
            width: 90px;
            height: 80px;
            background: #fff3e0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }

        .scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            touch-action: none;
            border-radius: 10px;
            transition: opacity 0.4s ease;
            z-index: 2;
        }

        #result-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
            z-index: 1000;
            text-align: center;
            width: 85%;
            max-width: 320px;
            border: 5px solid #d32f2f;
        }

        #modal-title { color: #d32f2f; font-size: 1.5rem; margin-bottom: 10px; }
        #modal-text { font-size: 1.2rem; font-weight: bold; line-height: 1.5; color: #333; }
        .modal-btn { background: #d32f2f; color: white; border: none; padding: 12px 25px; border-radius: 50px; margin-top: 20px; font-size: 1.1rem; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="grid-container" id="grid"></div>

    <div id="result-modal">
        <div id="modal-emoji" style="font-size: 3.5rem; margin-bottom: 10px;">üéä</div>
        <div id="modal-title">Ë≤°Á•ûÂ†±Âñú</div>
        <div id="modal-text"></div>
        <button class="modal-btn" onclick="closeModal()">ÂÜçÁé©‰∏ÄÊ¨°</button>
    </div>

    <script>
        // 1. ‰∏ÄËà¨Ë≥ÄË©û (5, 6, 8 ÂÄãÊôÇËß∏Áôº)
        const normalMap = {
            'üí∞': "Âá∫Áèæ‰∫ÜÔºÅ‰ªäÂπ¥Ë≥∫Â§ßÈå¢ÔºÅ",
            'üßß': "Â•ΩÈÅãÂà∞ÔºÅ‰ªäÂπ¥Á¥ÖÂà©È†ò‰∏çÂÆåÔºÅ",
            'üíé': "‰∫ÆÈñÉÈñÉÔºÅÈáëÈäÄÁè†ÂØ∂ÊªøÂéùÈñìÔºÅ",
            'üçä': "Â§ßÂêâÂà©ÔºÅÂ§ßÂêâÂ§ßÂà©ÁôºÂ§ßË≤°ÔºÅ",
            '‚ú®': "ÈñÉ‰∫Æ‰∫ÆÔºÅ‰ªäÂπ¥ÈÅãÂã¢‰∫ÆÊô∂Êô∂ÔºÅ",
            'üçç': "Êó∫Êó∫‰æÜÔºÅ‰ªäÂπ¥Âπ¥È†≠Êó∫Âà∞Âπ¥Â∞æÔºÅ",
            'üß®': "ÈüøÂèÆÂôπÔºÅÂ§©Â§©‰∏≠Â§ßÁçéÔºåÈûïÁÇÆÈüø‰∏çÂÅúÔºÅ"
        };

        // 2. ÁµÇÊ•µË≥ÄË©û (9 ÂÄãÂÖ®‰∏≠ÊôÇËß∏Áôº)
        const superMap = {
            'üí∞': "„ÄêÁµÇÊ•µË≤°Á•û„Äë9ÂÄãüí∞ÂÖ®ÈñãÔºÅÂØåÁî≤Â§©‰∏ãÔºÅ",
            'üßß': "„ÄêÁ¥ÖÂåÖ‰πãÁéã„Äë9ÂÄãüßßÂÖ®ÈñãÔºÅË≤°Â∫´ÊªøÁõàÔºÅ",
            'üíé': "„ÄêËá≥Â∞äÁè†ÂØ∂„Äë9ÂÄãüíéÂÖ®ÈñãÔºÅÂØåË≤¥‰∏ÄÁîüÔºÅ",
            'üçä': "„ÄêË∂ÖÁ¥öÂ§ßÂêâ„Äë9ÂÄãüçäÂÖ®ÈñãÔºÅËê¨‰∫ãÂ§ß‰∫®ÈÄöÔºÅ",
            '‚ú®': "„ÄêÁ•ûÂÖâÊôÆÁÖß„Äë9ÂÄã‚ú®ÂÖ®ÈñãÔºÅÈÅãÂã¢ÁÑ°ÊïµÂº∑ÔºÅ",
            'üçç': "„ÄêË∂ÖÁ¥öÊó∫‰æÜ„Äë9ÂÄãüççÂÖ®ÈñãÔºÅÂ•ΩÈÅãÁàÜÊ£ö‰∫ÜÔºÅ",
            'üß®': "„ÄêÂ§ßÁçéËá®ÈñÄ„Äë9ÂÄãüß®ÂÖ®ÈñãÔºÅÈ©öÂñúÈÄ£ÈÄ£ÁôºÔºÅ"
        };

        const gridElement = document.getElementById('grid');
        const modal = document.getElementById('result-modal');
        const modalText = document.getElementById('modal-text');
        
        let clearedCount = 0;
        let winner = { symbol: '', count: 0 };

        // Á≤íÂ≠êÈ°ûÂà• (ÈáëÁ≤âÁâπÊïà)
        class Particle {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.size = Math.random() * 3 + 1;
                this.speedX = Math.random() * 2 - 1;
                this.speedY = Math.random() * 2 - 1;
                this.color = `rgba(255, ${215 + Math.random() * 40}, 0, ${Math.random() * 0.8 + 0.2})`;
                this.life = 1;
            }
            update() { this.x += this.speedX; this.y += this.speedY; this.life -= 0.02; }
            draw(ctx) { ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
        }

        function initGame() {
            gridElement.innerHTML = '';
            clearedCount = 0;
            modal.style.display = 'none';

            // --- Ê†∏ÂøÉÈÄªËæëÔºöÁîüÊàê‰∏≠Â•ñÂàÜÂ∏É ---
            const keys = Object.keys(normalMap);
            const countsToPick = [5, 6, 8, 9];
            const targetCount = countsToPick[Math.floor(Math.random() * countsToPick.length)];
            const targetSymbol = keys[Math.floor(Math.random() * keys.length)];
            
            winner = { symbol: targetSymbol, count: targetCount };

            let board = new Array(9).fill(null);
            
            // ÂÖàÂ°´ÂÖ•ÁõÆÊ®ôÊï∏ÈáèÁöÑ Symbol
            let indices = [0,1,2,3,4,5,6,7,8].sort(() => Math.random() - 0.5);
            for(let i=0; i < targetCount; i++) {
                board[indices[i]] = targetSymbol;
            }

            // Ââ©‰∏ãÊ†ºÂ≠êÂ°´ÂÖ•Èö®Ê©ü Symbol (‰∏çË∂ÖÈÅé‰∏ªËßíÊï∏Èáè)
            for(let i=0; i<9; i++) {
                if(board[i] === null) {
                    let randomSym;
                    do {
                        randomSym = keys[Math.floor(Math.random() * keys.length)];
                    } while (randomSym === targetSymbol);
                    board[i] = randomSym;
                }
            }

            board.forEach(sym => createScratchCard(sym));
        }

        function createScratchCard(symbol) {
            const card = document.createElement('div');
            card.className = 'scratch-card';
            card.innerHTML = `<span>${symbol}</span>`;

            const pCanvas = document.createElement('canvas');
            pCanvas.className = 'particle-canvas';
            const pCtx = pCanvas.getContext('2d');
            
            const sCanvas = document.createElement('canvas');
            sCanvas.className = 'scratch-canvas';
            const sCtx = sCanvas.getContext('2d');

            card.appendChild(pCanvas);
            card.appendChild(sCanvas);
            gridElement.appendChild(card);

            pCanvas.width = sCanvas.width = 90;
            pCanvas.height = sCanvas.height = 80;

            const gradient = sCtx.createLinearGradient(0, 0, 90, 80);
            gradient.addColorStop(0, '#C0C0C0');
            gradient.addColorStop(1, '#A9A9A9');
            sCtx.fillStyle = gradient;
            sCtx.fillRect(0, 0, 90, 80);

            let particles = [];
            let isDrawing = false;
            let isRemoved = false;

            function animate() {
                pCtx.clearRect(0, 0, 90, 80);
                particles.forEach((p, i) => {
                    p.update(); p.draw(pCtx);
                    if (p.life <= 0) particles.splice(i, 1);
                });
                if (!isRemoved || particles.length > 0) requestAnimationFrame(animate);
            }
            animate();

            function scratch(e) {
                if (!isDrawing || isRemoved) return;
                const rect = sCanvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                for (let i = 0; i < 5; i++) particles.push(new Particle(x, y));
                sCtx.globalCompositeOperation = 'destination-out';
                sCtx.beginPath();
                sCtx.arc(x, y, 18, 0, Math.PI * 2);
                sCtx.fill();
                checkScratchPercent(sCanvas, sCtx);
            }

            function checkScratchPercent(canvas, ctx) {
                if (isRemoved) return;
                const imageData = ctx.getImageData(0, 0, 90, 80);
                const pixels = imageData.data;
                let transparentPixels = 0;
                for (let i = 0; i < pixels.length; i += 4) if (pixels[i + 3] < 150) transparentPixels++;
                
                if ((transparentPixels / (90 * 80)) > 0.55) {
                    isRemoved = true;
                    canvas.style.opacity = '0';
                    clearedCount++;
                    setTimeout(() => canvas.remove(), 400);
                    if (clearedCount === 9) showResult();
                }
            }

            sCanvas.addEventListener('mousedown', () => isDrawing = true);
            sCanvas.addEventListener('touchstart', (e) => { isDrawing = true; e.preventDefault(); });
            window.addEventListener('mouseup', () => isDrawing = false);
            window.addEventListener('touchend', () => isDrawing = false);
            sCanvas.addEventListener('mousemove', scratch);
            sCanvas.addEventListener('touchmove', (e) => { scratch(e); e.preventDefault(); });
        }

        function showResult() {
            const emojiEl = document.getElementById('modal-emoji');
            
            // Âà§Êñ∑ÊòØÂê¶ÁÇ∫ 9 ÂÄãÂÖ®‰∏≠Ê®°Âºè
            if (winner.count === 9) {
                modalText.innerText = superMap[winner.symbol];
                emojiEl.innerText = "üßß"; // ÂÖ®‰∏≠ÊîπÁî®ÁâπÂà•ÂúñÁ§∫
            } else {
                modalText.innerText = normalMap[winner.symbol];
                emojiEl.innerText = "üéä";
            }
            
            setTimeout(() => { modal.style.display = 'block'; }, 500);
        }

        function closeModal() { initGame(); }
        initGame();
    </script>
</body>
</html>
